---
title: "Weather Data Preprocessing"
author: "Paul"
output: html_document
---

```{r}
library(dplyr)
```


```{r}
#df <- read.csv("uber-raw-data-janjune-15.csv")
noaa.df <- read.csv("NYCweather_hourly_full.csv")
```


```{r}
#df
noaa.df
```

```{r}
colnames(noaa.df)
```

```{r}
df <- noaa.df %>% 
  filter(noaa.df$REPORT_TYPE == 'SOD  ') %>% #Only daily records
  subset(select = c("DATE","DailyPrecipitation","DailyAverageRelativeHumidity",
                    "DailyAverageWindSpeed",
                    "DailyPeakWindSpeed",
                    "DailyAverageDewPointTemperature",
                    "DailyAverageDryBulbTemperature",
                    "DailyAverageWetBulbTemperature",
                    "DailyMaximumDryBulbTemperature",
                    "DailyMinimumDryBulbTemperature",
                    "DailyDepartureFromNormalAverageTemperature",
                    "DailySnowfall","DailySnowDepth","DailyWeather")) 

df$DATE = substr(df$DATE,1,10)
df <- rename(df,Date = DATE)
```



```{r}
df2 <- read.csv("rides_by_date.csv")
#colnames(df2)

df2 <- rename(df2, Date = X)
df2 <- rename(df2, TotalRides = Total.Rides)
df2 <- rename(df2, "7DayAvgRides" = X7.Day.Average.Rides)
#df2

df3 <- left_join(df2, df, by='Date')
df3
```



```{r}
unique(df3$DailyWeather)
```

RA = Rain
BR = Mist
HZ = Haze
FG = Fog
SN = Snow

```{r}
df3$rain <- 0
df3$mist <- 0
df3$haze <- 0
df3$fog <- 0
df3$snow <- 0

df3[df3$DailyWeather=='RA',]$rain <-  1
df3[df3$DailyWeather=='RA BR HZ',]$rain <-  1
df3[df3$DailyWeather=='RA FG BR',]$rain <-  1
df3[df3$DailyWeather=='RA SN BR',]$rain <-  1
df3[df3$DailyWeather=='RA BR',]$rain <-  1
df3[df3$DailyWeather=='RA FG BR HZ',]$rain <-  1
df3[df3$DailyWeather=='RA HZ',]$rain <-  1
df3[df3$DailyWeather=='RA BR HZ',]$mist <-  1
df3[df3$DailyWeather=='BR',]$mist <-  1
df3[df3$DailyWeather=='RA FG BR',]$mist <-  1
df3[df3$DailyWeather=='RA SN BR',]$mist <-  1
df3[df3$DailyWeather=='RA BR',]$mist <-  1
df3[df3$DailyWeather=='RA FG BR HZ',]$mist <-  1
df3[df3$DailyWeather=='BR HZ',]$mist <-  1
df3[df3$DailyWeather=='RA BR HZ',]$haze <-  1
df3[df3$DailyWeather=='RA FG BR HZ',]$haze <-  1
df3[df3$DailyWeather=='HZ',]$haze <-  1
df3[df3$DailyWeather=='BR HZ',]$haze <-  1
df3[df3$DailyWeather=='RA HZ',]$haze <-  1
df3[df3$DailyWeather=='RA FG BR',]$fog <-  1
df3[df3$DailyWeather=='RA FG BR HZ',]$fog <-  1
df3[df3$DailyWeather=='RA SN BR',]$snow <-  1
df3[df3$DailySnowfall=='T',]$snow <-  1

df3 <- df3 %>% select(-c("DailyWeather"))
df3
```



```{r}
write.csv(df3, "weather_rides.csv")
```






